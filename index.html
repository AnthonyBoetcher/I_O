<!DOCTYPE html>
<html lang="en">
<head>
      <title>I/O</title>  
        <meta charset="utf-8" />
        <!-- bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <meta name="type" content="UCT Starlings project" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- leaflet css -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
        <!-- leaflet js -->
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
 integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
 crossorigin=""></script>

 <link rel="icon" type="image/x-icon" href="favicon.jpg">
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
        

<style>
body {
  background-image: url('4.png');
}

footer{
  margin: 20px 0 0 0;
}
  
  #leaflet-map {
    width: 100vw;
    height: 100vh;
    
  }

  /* z-index for for navbar */
  .leaflet-top,
  .leaflet-bottom {
    z-index: 999;
  }

  #details {
    background-color: #f9f9f9;
    max-height: 75vh;
    overflow-y: auto;
    overflow-x: hidden;
  }

  #details .help {
    flex-direction: column;
    height: 100%;
    min-height: 200px;
  }

  #details .help .box {
    height: 50%;
    min-height: 100px;
    display: flex;
    align-items: center;
  }

  #details .project-details {
    height: 100%;
  }

  #details svg {
    width: 40px;
  }

  #details .return-to-list,
  .results .reset-filter,
  .clear-filter {
    cursor: pointer;
  }

  #details .website-url svg,
  #details .file-url svg,
  #details .return-to-list svg {
    height: 16px;
    width: 16px;
    margin-right: 4px;
    margin-top: -4px;
  }

  #details .type,
  #details table {
    font-size: 1rem;
  }

  #details .col-img {
    justify-content: flex-end;
    flex-direction: column;
  }

  #details img {
    width: 100%;
    max-height: 250px;
    object-fit: cover;
    border-bottom-left-radius: .25rem;
  }

  @media(min-width: 992px) {
    #details {
      border-top-right-radius: 0 !important;
      border-bottom-right-radius: 0 !important;
      border-right: none !important;
      height: 100%;
    }

    #leaflet-map {
      border-top-left-radius: 0 !important;
      border-bottom-left-radius: 0 !important;
    }
  }

  #details:not(.show-project) .project-details,
  #details:not(.no-results) .no-results,
  #details:not(.results) .results,
  #details.show-project .help,
  #details.no-results .help,
  #details.results .help {
    display: none !important;
  }

</style>

    </head>

    <body>      
      <div id="leaflet-map"></div>

</footer>


        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
        <script type="text/javascript" src="/static/js/wsud.js"></script>

        
<!-- leaflet js -->
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
  integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
  crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<script>
// map var -----------------------------------------------------------------------------------------------------------------------------
  var map = L.map("leaflet-map").setView([-33.95608517289068, 18.461008169660417], 20);

  // add basemap  -------------------------------------------------------------------------------------------------------------------------------
  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);
  
  L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}", {
      attribution: "Map data &copy; <a href='https://www.openstreetmap.org/'>OpenStreetMap</a> contributors, <a href='https://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, Imagery Â© <a href='https://www.mapbox.com/'>Mapbox</a>",
      maxZoom: 18,
      id: "mapbox/streets-v11",
      tileSize: 512,
      zoomOffset: -1,
      accessToken: "pk.eyJ1IjoibmV3YW50dHdvIiwiYSI6ImNscWF3eHFvNjFxMDkyc252bDZnMHo0bW4ifQ.aibMJNvuCUcEtYZmu9VTVw",
  }).addTo(map);



  // define icons  -----------------------------------------------------------------------------------------------------------------
  var bird = L.icon({
    iconUrl: "birdbgr.png",
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  var egg = L.icon({
    iconUrl: "eggbgr1.png",
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [15, 25],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  var unknown = L.icon({
    iconUrl: "questionbgr.png",
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [20, 30],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  // define bird sightings --------------------------------------------------------------------------------------------------------
  var map = L.map('map').setView([-33.97580256588796, 18.455148569840915], 16); // Adjusted the center for your markers

  L.Icon.Default.prototype.options.iconUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png';
L.Icon.Default.prototype.options.iconRetinaUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png';
L.Icon.Default.prototype.options.shadowUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png';

// Set up the tile layer (for example, OpenStreetMap)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

// Add markers to the map using the specified coordinates
coordinates.forEach(function(coord) {
    L.marker(coord).addTo(map);
});

    const entry_1 = L.marker([-33.97580256588796, 18.455148569840915], {
      "icon": egg,
      "properties": {
        "name": "XMEE with mate and 2 unringed fledgies, 11/23",
        "type": "Nest", 
        "aim": "Nov",
        "year": "2023"
      },
    });
  
    const entry_2 = L.marker([-33.97593925499413, 18.4552646473379], {
      "icon": bird,
      "properties": {
        "name": "WMOY & XMGG, collecting nesting material, 11/23",
        "type": "Bird",
        "aim": "Nov",
        "year": "2023"
      },
    });

    const entry_3 = L.marker([-33.97581315448854, 18.455271611987715], {
      "icon": egg,
      "properties": {
        "name": "RMGY with mate and 2 unringed fledgies, 11/23",
        "type": "Nest",
        "aim": "Nov",
        "year": "2023"
      },
    });

    const entry_4 = L.marker([-33.975699567613475, 18.455282058962442], {
      "icon": bird,
      "properties": {
        "name": "XMBB, 12/23",
        "type": "Bird",
                "aim": "Dec",
        "year": "2023"
      },
    });

    const entry_5 = L.marker([-33.9757746504801, 18.455423673508765], {
      "icon": egg,
      "properties": {
        "name": "RMOV with 2 fledgies, 12/23",
        "type": "Bird",
                "aim": "Dec",
        "year": "2023"
      },
    });

    const entry_6 = L.marker([-33.9757409594584, 18.45544108513331], {
      "icon": bird,
      "properties": {
        "name": "WMWG, 12/23",
        "type": "Bird",
                "aim": "Dec",
        "year": "2023"
      },
    });

    const entry_7 = L.marker([-33.97564469932286, 18.45531107833669], {
      "icon": bird,
      "properties": {
        "name": "XMRG & WMGY, 12/23",
        "type": "Bird",
                "aim": "Dec",
        "year": "2023"
      },
    });

  const allEntries = [
    
      entry_1,
    
      entry_2,
    
      entry_3,

      entry_4,

      entry_5,

      entry_6,

      entry_7,
  ];

  // function when selecting a marker
  function selectMarker(e) {
    let properties = e.sourceTarget.options.properties;

    $("#details").addClass("show-project").removeClass("no-results results");

    $(".project-details .name").text(properties.name)
/*
    $(".project-details .type").html(properties.type)
    $(".project-details .type").text(properties.type)
    $(".project-details .aim").text(properties.aim)*/

    if (properties.website_url.length > 5) {
      $(".project-details .website-url").attr("href", properties.website_url).removeAttr("hidden")
    } else {
      $(".project-details .website-url").attr("hidden", "hidden")
    }

    if (properties.file) {
      $(".project-details .file-url").attr("href", properties.file).removeAttr("hidden")
    } else {
      $(".project-details .file-url").attr("hidden", "hidden")
    }

    let linkText;
    if (properties.link == "cop") {
      linkText = "COP linked"
    } else if (properties.link == "museum") {
      linkText = "Museum linked"
    }

    $(".project-details .link").text(linkText);

    $(".project-details img").attr("src", properties.image)
  }

  // unselect project and return to list
  function unselectMarker() {
    $("#details").removeClass("show-project").addClass("results");
    $(".leaflet-tooltip").remove();
  }

  // button to unselect marker and return to list
  $(".return-to-list").click(function() {
    unselectMarker();
    filterMarkers()
  })

  // make a feature group with all listings and add it to the map
  const allMarkers = L.featureGroup(allEntries).bindTooltip(function(layer) {return String(layer.options.properties.name)}).on("click", selectMarker);

  var clusteredMarkers = L.markerClusterGroup();
  clusteredMarkers.addLayer(allMarkers);
  map.addLayer(clusteredMarkers);


  // click on project in the list to select the marker
  // $(document.body).on("click", ".listed-project", function(event) {
    // let marker = $(this).data("id");
    // $(filteredLayer._layers[marker]._icon).click();
  // });

  // set the bounds of the map around all content
  map.fitBounds(allMarkers.getBounds())
</script>

    </body>
</html>
